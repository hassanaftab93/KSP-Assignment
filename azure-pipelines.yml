trigger:
- main

pool:
  name: Azure Pipelines

stages:

  - stage: 'Restore'
    displayName: 'Restore'
    jobs:
      - job: restore
        steps:
        - task: DotNetCoreCLI@2
          displayName: Restore
          inputs:
            command: restore
            projects: '$(Parameters.RestoreBuildProjects)'

  - stage: 'Build'
    displayName: 'Build'
    jobs:
      - job: build
        steps:
        - task: DotNetCoreCLI@2
          displayName: Build
          inputs:
            projects: '$(Parameters.RestoreBuildProjects)'
            arguments: '--configuration $(BuildConfiguration)'

  - stage: 'Test'
    displayName: 'Test'
    jobs:
      - job: test
        steps:
        - task: DotNetCoreCLI@2
          displayName: Test
          inputs:
            command: test
            projects: '$(Parameters.TestProjects)'
            arguments: '--configuration $(BuildConfiguration)'

  - stage: 'Publish'
    displayName: 'Publish'
    jobs:
      - job: publish
        steps:
        - task: DotNetCoreCLI@2
          displayName: Publish
          inputs:
            command: publish
            publishWebProjects: True
            arguments: '--configuration $(BuildConfiguration) --output $(build.artifactstagingdirectory)'
            zipAfterPublish: True
      - job: publishToPath
        steps:
        - task: PublishBuildArtifacts@1
          displayName: 'Publish Artifact'
          inputs:
            PathtoPublish: '$(build.artifactstagingdirectory)'
          condition: succeededOrFailed()
